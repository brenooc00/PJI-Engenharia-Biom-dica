---
title: "PJI - acelerometro"
author: "Breno, Brenda, Fernanda, Maria Eduarda"
date: "18/08/2024"
output: 
  pdf_document: default
  html_document:
    highlight: tango
    includes:
      after_body: psbfix.html
---

## Bibliotecas

```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(dygraphs)
library(dplyr)
library(patchwork)
```

# Módulo 1

## Importando arquivos

```{r}
df1_controle <- read.table("Grupo3 Acelerometro Controle.txt", header = TRUE, sep = "\t")

df1_problema <- read.table("Grupo3 Acelerometro Problema Motor.txt", header = TRUE, sep = "\t")
```

## Conversão de dados

```{r}
#Convertendo o separador decimal de ',' para '.'
df1_controle <- as.data.frame(lapply(df1_controle, function(x) as.numeric(gsub(",", ".", x))))

df1_problema <- as.data.frame(lapply(df1_problema, function(x) as.numeric(gsub(",", ".", x))))

#Convertendo DataFrame para classe númerica
df1_controle[] <- lapply(df1_controle, as.numeric)
df1_problema[] <- lapply(df1_problema, as.numeric)
```

## Plotando sinal

```{r}
plot_controle_C1 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C1), color = "red") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 1")

plot_controle_C2 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C2), color = "salmon") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 2")

plot_controle_C3 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C3), color = "green") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 3")

plot_controle_C4 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C4), color = "brown") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 4")

plot_controle_C5 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C5), color = "blue") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 5")

(plot_controle_C1 | plot_controle_C2)/
(plot_controle_C3 | plot_controle_C4)/
(plot_controle_C5)


for (col in names(df1_problema)[-1]) {
  # Criar um gráfico para cada coluna
  dygraph(data.frame(time = df1_problema$Tempo, value = df1_problema[[col]]), main = paste("Gráfico de", col))|>
    dyAxis("x", label = "Tempo (s)") |>
    dyAxis("y", label = "Amplitude") |>
    dyRangeSelector(dateWindow = c()) |> dyCSS(textConnection(" .dygraph-title{color : black;}")) |>
    print()  # Para visualizar os gráficos no console do R
}

```

## Observando espectro do sinal

```{r}
fft_signal <- function(time, signal, name){
  dt <- time[2] - time[1] #Resolução temporal
  fs <- 1/dt #Frequência
  rfs <- fs/length(time) #Resolução de frequência
  final_frequency <- (length(time)-1) * rfs #Frequência final
  ff <- seq(from = 0, to = final_frequency, by = rfs) #Vetor de frequência
  signal_fft <- fft(signal) #Transformada de Fourier
  signal_mag <- Mod(signal_fft) #Magnitude do sinal
  signal_theta <- atan2(Im(signal_fft), Re(signal_fft)) #Fase do sinal
  
  plot_mag <- ggplot2::ggplot(data.frame(ff, signal_mag)) + geom_line(aes(x = ff, y = signal_mag), color = "green") + xlab("Frequência (Hz)") + ylab("Magnitude") + labs(title = paste("Espectro de amplitude do sinal", name)) + coord_cartesian(xlim = c(0,final_frequency/2)) 
  
  #plot_theta <- ggplot2::ggplot(data.frame(ff, signal_theta)) + geom_line(aes(x = ff, y = signal_theta), color = "green") + xlab("Frequência (Hz)") + ylab("Fase") + labs(title = paste("Fase do sinal", name)) + coord_cartesian(xlim = c(0,final_frequency/2)) 
  
  print(plot_mag)
  #print(plot_theta)
}

#Amplitude do sinal grupo controle
fft_signal(df1_controle$Tempo, df1_controle$C1, "(grupo controle C1)")
fft_signal(df1_controle$Tempo, df1_controle$C2, "(grupo controle C2)")
fft_signal(df1_controle$Tempo, df1_controle$C3, "(grupo controle C3)")
fft_signal(df1_controle$Tempo, df1_controle$C4, "(grupo controle C4)")
fft_signal(df1_controle$Tempo, df1_controle$C5, "(grupo controle C5)")

#Amplitude do sinal grupo problema motor
fft_signal(df1_problema$Tempo, df1_problema$DP1, "(grupo problema motor DP1)")
fft_signal(df1_problema$Tempo, df1_problema$DP2, "(grupo problema motor DP2)")
fft_signal(df1_problema$Tempo, df1_problema$DP3, "(grupo problema motor DP3)")
fft_signal(df1_problema$Tempo, df1_problema$DP4, "(grupo problema motor DP4)")
fft_signal(df1_problema$Tempo, df1_problema$DP5, "(grupo problema motor DP5)")
```

## Cálculo de amplitude MAV - Mean Absolute Value

```{r}
MAV <- function(signal, name){
  MAV_signal <- mean(abs(signal))
  print(paste("Resultado MAV do sinal ", name, ":", round(MAV_signal,3)))
  return (MAV_signal)
}

MAV_C1 <- MAV(df1_controle$C1, "C1 (grupo controle)")
MAV_C2 <- MAV(df1_controle$C2, "C2 (grupo controle)")
MAV_C3 <- MAV(df1_controle$C3, "C3 (grupo controle)")
MAV_C4 <- MAV(df1_controle$C4, "C4 (grupo controle)")
MAV_C5 <- MAV(df1_controle$C5, "C5 (grupo controle)")

print("")

MAV_DP1 <- MAV(df1_problema$DP1, "DP1 (grupo problema motor)")
MAV_DP2 <- MAV(df1_problema$DP2, "DP2 (grupo problema motor)")
MAV_DP3 <- MAV(df1_problema$DP3, "DP3 (grupo problema motor)")
MAV_DP4 <- MAV(df1_problema$DP4, "DP4 (grupo problema motor)")
MAV_DP5 <- MAV(df1_problema$DP5, "DP5 (grupo problema motor)")
```

## Cálculo de frequência - F80

```{r}
```

## Cálculo estátisco - Diferença interquartil

```{r}
```
