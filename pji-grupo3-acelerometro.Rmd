---
title: "PJI - acelerometro"
author: "Breno, Brenda, Fernanda, Maria Eduarda"
date: "18/08/2024"
output: 
  pdf_document: default
  html_document:
    highlight: tango
    includes:
      after_body: psbfix.html
---

## Bibliotecas

```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(dygraphs)
library(dplyr)
library(patchwork)
```

## Importando arquivos

```{r}
df1_controle <- read.table("Grupo3 Acelerometro Controle.txt", header = TRUE, sep = "\t")

df1_problema <- read.table("Grupo3 Acelerometro Problema Motor.txt", header = TRUE, sep = "\t")
```

## Conversão de dados

```{r}
#Convertendo o separador decimal de ',' para '.'
df1_controle <- as.data.frame(lapply(df1_controle, function(x) as.numeric(gsub(",", ".", x))))

df1_problema <- as.data.frame(lapply(df1_problema, function(x) as.numeric(gsub(",", ".", x))))

#Convertendo DataFrame para classe númerica
df1_controle[] <- lapply(df1_controle, as.numeric)
df1_problema[] <- lapply(df1_problema, as.numeric)
```

## Plotando sinal

```{r}
plot_controle_C1 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C1), color = "red") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 1")

plot_controle_C2 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C2), color = "salmon") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 2")

plot_controle_C3 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C3), color = "green") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 3")

plot_controle_C4 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C4), color = "brown") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 4")

plot_controle_C5 <- ggplot2::ggplot() + geom_line(data = df1_controle, aes(x = Tempo, y = C5), color = "blue") + xlab("Tempo(s)") + ylab("Amplitude") + labs(title = "Indivíduo 5")

(plot_controle_C1 | plot_controle_C2)/
(plot_controle_C3 | plot_controle_C4)/
(plot_controle_C5)


for (col in names(df1_problema)[-1]) {
  # Criar um gráfico para cada coluna
  dygraph(data.frame(time = df1_problema$Tempo, value = df1_problema[[col]]), main = paste("Gráfico de", col))|>
    dyAxis("x", label = "Tempo (s)") |>
    dyAxis("y", label = "Amplitude") |>
    dyRangeSelector(dateWindow = c()) |> dyCSS(textConnection(" .dygraph-title{color : black;}")) |>
    print()  # Para visualizar os gráficos no console do R
}

```

## Observando espectro do sinal

```{r}
fft_signal <- function(time, signal){
  dt <- time[2] - time[1] #Resolução temporal
  fs <- 1/dt #Frequência
  rfs <- fs/length(time) #Resolução de frequência
  final_frequency <- (length(time)-1) * rfs #Frequência final
  ff <- seq(from = 0, to = final_frequency, by = rfs) #Vetor de frequência
  signal_fft <- fft(signal) #Transformada de Fourier
  singal_mag <- mod(signal_fft) #Magnitude do sinal
  signal_theta <- atan2(Im(signal_fft), Re(signal_fft)) #Fase do sinal
  
}


#dygraph(data.frame(ff,mag), main = "Espectro de Amplitude", 
 #xlab = "frequencia (Hz)", ylab = "amplitude") |> 
 #dyRangeSelector()|> 
 #dyEvent(fs_500/2, label='SIMETRIA', labelLoc='top') 


#dygraph(data.frame(ff,theta),main = "Espectro de Fase", 
 #xlab = "frequencia (Hz)", ylab = "fase")|> 
 #dyRangeSelector()|> 
 #dyEvent(fs_500/2, label='SIMETRIA', labelLoc='top')
```
